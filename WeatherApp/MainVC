//
//  ViewController.swift
//  WeatherApp
//
//  Created by Mohamed Atallah on 10/11/2022.
//

import UIKit
import Alamofire

class MainVc: UIViewController {
    
    var cityName = "Egypt"

    @IBOutlet weak var cityNameTextField: UITextField!
    @IBOutlet weak var cityNameLabel: UILabel!
    @IBOutlet weak var weatherImageView: UIImageView!
    @IBOutlet weak var tempLabel: UILabel!
    @IBOutlet weak var humidityLabel: UILabel!
    @IBOutlet weak var activityIndicator: UIActivityIndicatorView!
    @IBOutlet weak var getButton: UIButton!
    
    override func viewDidLoad() {
       
        super.viewDidLoad()
        
        getButton.layer.cornerRadius = 15
        
        getWetherByCityName()
        
    }

    @IBAction func getButtonClicked(_ sender: Any) {
        
        cityName = cityNameTextField.text!
        getWetherByCityName()
        
//        if let name = cityName {
//            for i in 0..<name.count {
//                if i == 0 {
//                    self.cityName.append(name.first!.uppercased())
//                }
//            }
//        }
        
    }
    
    func getWetherByCityName() {
        
        let params = ["q": cityName, "appid": "8032c4d64bd00a5bd80d72917b57ad4b"]
        
        activityIndicator.isHidden = false
        activityIndicator.startAnimating()
        AF.request("https://api.openweathermap.org/data/2.5/weather", parameters: params, encoder: URLEncodedFormParameterEncoder.default).responseJSON { response in
            if let result = response.value {
            
                let JSON = result as! NSDictionary

                guard let main = JSON["main"] as? NSDictionary else {
                    let alert = UIAlertController(title: "Error!", message: "Wrong City Name", preferredStyle: .alert)
                    let closeAction = UIAlertAction(title: "OK", style: .default)
                    alert.addAction(closeAction)
                    self.present(alert, animated: true)
                    self.activityIndicator.isHidden = true
                    return
                }
                var temp = main["temp"] as! Double - 272.15
                temp = Double(round(1000 * temp) / 1000)
                let humidity = main["humidity"] as! Int
                
                self.activityIndicator.stopAnimating()
                self.activityIndicator.isHidden = true
                self.tempLabel.text = "\(temp)"
                self.humidityLabel.text = "\(humidity)"
                
//                if temp < 10 {
//                    self.weatherImageView.image = UIImage(systemName: "cloud.snow")
//        
//                }else if temp < 25 {
//                    self.weatherImageView.image = UIImage(systemName: "cloud.rain")
//                }else {
//                    self.weatherImageView.image = UIImage(systemName: "cloud.rain")
//                }
                
            }
        }
        
    }
    
    func changImage() {
        
    }
    
}

